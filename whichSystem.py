#!/usr/bin/python3
#codign: utf-8



# forma de ejecutarlo ejemplo funcional : sudo python3 whichSystem.py 10.10.11.174
import re,sys, subprocess

#salida final del sistema aqui se a desplegar y cerrar el sistema
if len(sys.argv) !=2:
    print("\n[!] Uso: python3 " + sys.argv[0] + " <dirreccion-ip>\n")
    sys.exit(1)

# con este se ejecuta el comando ping -c 1 <dirreccion ip> y podemos saber si la maquina es windows o linux

def get_ttl(ip_address):
    proc = subprocess.Popen(["/usr/bin/ping -c 1 %s" % ip_address, ""], stdout=subprocess.PIPE, shell=True)
    (out,err) = proc.communicate()
    out = out.split()
    out = out[12].decode('utf-8')

    ttl_value = re.findall(r"\d{1,3}",out)[0]
    return ttl_value


# aqui detectamos si el sistema esta mas cerca de 64 significa que es un linux si esta mas cerca de 128 significa que es un windows probablemente
def get_os(ttl):
    ttl = int(ttl)
    if ttl >= 0 and ttl <= 64:
        return "linux"
    elif ttl >= 65 and ttl <= 128:
        return 'Windows'
    else:
        return "Error: \n Sistema operativo desconocido || sistema no encontrado"

if __name__ == "__main__":
    ip_address = sys.argv[1]
    ttl = get_ttl(ip_address)
    os_name = get_os(ttl)
    print("\n%s (ttl ->%s): %s\n" % (ip_address,ttl,os_name))